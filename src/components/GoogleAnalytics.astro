---
const gaId = import.meta.env.PUBLIC_GOOGLE_ANALYTICS_ID;
---

{gaId && (
  <>
    <script type="text/partytown" async src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}></script>
    <script type="text/partytown" define:vars={{ gaId }}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', gaId);
      
      // Configuración para tracking de eventos personalizados
      document.addEventListener('DOMContentLoaded', function() {
        // Obtener todas las secciones principales
        const sections = document.querySelectorAll('section[id]');
        
        // Configurar el observador de intersección
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              // Enviar evento a GA cuando una sección es visible
              gtag('event', 'view_section', {
                'section_id': entry.target.id,
                'section_name': entry.target.getAttribute('data-section-name') || entry.target.id
              });
            }
          });
        }, { threshold: 0.5 }); // Visible cuando al menos el 50% de la sección está en pantalla
        
        // Observar cada sección
        sections.forEach(section => {
          observer.observe(section);
        });
        
        // Tracking de clics en enlaces importantes
        document.querySelectorAll('a[data-track]').forEach(link => {
          link.addEventListener('click', function() {
            gtag('event', 'click', {
              'event_category': 'link',
              'event_label': this.getAttribute('data-track') || this.href
            });
          });
        });
      });
    </script>
  </>
)}